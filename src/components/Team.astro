---
import { useTranslations, getLangFromUrl } from '../i18n/utils';
import { ChevronLeft, ChevronRight } from 'lucide-astro';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const team = [
  { name: 'Dra. Ana Padilla', role: 'Cirugía, implantología y estética dental', image: '/equipo/Ana-padilla.jpg' },
  { name: 'Melina Bernkopf', role: 'Recepcionista', image: '/equipo/Melina-bernkopf.jpg' },
  { name: 'Dra. Ana Soler', role: 'Ortodoncista, Odontopediatría', image: '/equipo/ana-soler.jpg' },
  { name: 'Ángela Perez', role: 'Auxiliar de clínica', image: '/equipo/angela-perez-.jpg' },
  { name: 'Dra. Ángeles Parra', role: 'Odontología general, Endodoncista', image: '/equipo/angeles-parrar.jpg' },
  { name: 'Ellé – Louise Warner', role: 'Asesora dental', image: '/equipo/elle-louise-warner.jpg' },
  { name: 'Anda Dorela', role: 'Auxiliar de clínica', image: '/equipo/Anda-dorela.jpg' },
  { name: 'Blaneirys Peña', role: 'Higienista Dental', image: '/equipo/blaneirys.jpg' },
  { name: 'Minerva Aznar', role: 'Higienista Dental', image: '/equipo/minerva.jpg' },
  { name: 'María Luisa Aguacil', role: 'Auxiliar de clínica', image: '/equipo/maria-luisa.jpg' },
  { name: 'Dra. Lorraynne Barbosa', role: 'Odontología general', image: '/equipo/Lorraynne-Barbosa.jpg' }
];
---

<section class="section-padding bg-white relative overflow-hidden">
  <!-- Decorative background elements -->
  <div class="absolute top-0 right-0 w-1/3 h-full bg-slate-50 border-l border-slate-100 -skew-x-12 translate-x-1/2 pointer-events-none z-0"></div>
  <div class="absolute bottom-20 left-10 w-64 h-64 bg-accent/5 rounded-full blur-3xl pointer-events-none"></div>

  <div class="container mx-auto px-6 relative z-10">
    <div class="flex flex-col lg:flex-row lg:items-end justify-between mb-20 gap-8 fade-up">
       <div class="max-w-3xl">
          <span class="inline-flex items-center gap-2 px-4 py-1.5 bg-blue-50 text-accent rounded-full text-[10px] font-black tracking-[0.3em] uppercase mb-8 border border-blue-100 shadow-sm">
             {t('team.factor')}
          </span>
          <h3 class="text-4xl md:text-6xl font-black text-primary leading-tight tracking-tighter italic">
             {t('team.title')}
          </h3>
       </div>
       
       <!-- Controls -->
       <div class="flex items-center gap-6">
          <div class="hidden md:flex flex-col items-end gap-2 pr-6 border-r border-slate-100">
             <p class="text-[10px] font-black uppercase text-slate-400 tracking-widest leading-none">{t('team.slider.scroll')}</p>
             <p class="text-xs font-bold text-primary italic leading-none">{t('team.slider.view')}</p>
          </div>
          <div class="flex gap-4">
             <button id="slider-prev" class="w-16 h-16 rounded-2xl border border-slate-100 bg-white flex items-center justify-center hover:bg-primary hover:text-white transition-all cursor-pointer shadow-sm hover:shadow-xl group">
               <ChevronLeft size={24} class="group-hover:-translate-x-1 transition-transform" />
             </button>
             <button id="slider-next" class="w-16 h-16 rounded-2xl border border-slate-100 bg-white flex items-center justify-center hover:bg-primary hover:text-white transition-all cursor-pointer shadow-sm hover:shadow-xl group">
               <ChevronRight size={24} class="group-hover:translate-x-1 transition-transform" />
             </button>
          </div>
       </div>
    </div>

    <!-- Team Slider Container -->
    <div class="relative">
       <div id="team-slider-container" class="overflow-visible">
          <div id="team-slider" class="flex gap-10 transition-transform duration-1000 ease-[cubic-bezier(0.23,1,0.32,1)] will-change-transform">
            {team.map((member) => (
              <div class="flex-none w-[320px] md:w-[450px] fade-up">
                <div class="relative rounded-[3rem] overflow-hidden aspect-[4/5] group/card border border-slate-100 bg-slate-50 shadow-sm hover:shadow-3xl transition-all duration-700">
                   <img src={member.image} alt={member.name} class="w-full h-full object-cover grayscale transition-all duration-1000 group-hover/card:grayscale-0 group-hover/card:scale-110" loading="lazy" decoding="async" />
                   
                   <!-- Mirror gradient overlay -->
                   <div class="absolute inset-x-0 bottom-0 h-2/3 bg-gradient-to-t from-primary/90 via-primary/20 to-transparent translate-y-full group-hover/card:translate-y-0 transition-transform duration-700"></div>
                   
                   <div class="absolute bottom-0 left-0 right-0 p-10 translate-y-8 opacity-0 group-hover/card:translate-y-0 group-hover/card:opacity-100 transition-all duration-700 delay-100">
                      <div class="w-10 h-1 bg-accent mb-6 rounded-full"></div>
                      <h4 class="text-white text-3xl font-black mb-2 italic tracking-tighter">{member.name}</h4>
                      <p class="text-slate-300 font-bold uppercase tracking-[0.3em] text-xs">{member.role}</p>
                   </div>

                   <!-- Professional Badge -->
                   <div class="absolute top-8 right-8 w-12 h-12 bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 flex items-center justify-center text-white opacity-0 scale-50 group-hover/card:opacity-100 group-hover/card:scale-100 transition-all duration-500">
                      <div class="w-2 h-2 bg-accent rounded-full animate-ping"></div>
                   </div>
                </div>
                
                <!-- Visible Info for Mobile/Tablet -->
                <div class="mt-8 px-4 flex flex-col lg:hidden">
                   <h4 class="text-primary text-2xl font-black italic tracking-tighter mb-1">{member.name}</h4>
                   <p class="text-accent text-xs font-black uppercase tracking-[0.2em]">{member.role}</p>
                </div>
              </div>
            ))}
          </div>
       </div>

       <!-- Slider Progress Bar -->
       <div class="mt-20 h-px bg-slate-100 relative max-w-xl">
          <div id="slider-progress" class="absolute top-0 left-0 h-full bg-accent transition-all duration-500 w-0"></div>
       </div>
    </div>
  </div>
</section>

<script>
  const slider = document.getElementById('team-slider');
  const prev = document.getElementById('slider-prev');
  const next = document.getElementById('slider-next');
  const progress = document.getElementById('slider-progress');
  
  let currentTranslate = 0;
  
  const updateProgress = () => {
    if (!slider || !progress) return;
    const scrollContainer = slider.parentElement;
    const maxScroll = slider.scrollWidth - scrollContainer.clientWidth;
    if (maxScroll <= 0) {
      progress.style.width = '100%';
      return;
    }
    const percentage = (currentTranslate / maxScroll) * 100;
    progress.style.width = `${Math.max(0, Math.min(100, percentage))}%`;
  };

  const moveSlider = (direction) => {
    if (!slider) return;
    const cardWidth = slider.firstElementChild?.offsetWidth || 0;
    const gap = 40; // gap-10
    const totalMove = cardWidth + gap;
    const scrollContainer = slider.parentElement;
    const maxScroll = slider.scrollWidth - scrollContainer.clientWidth;

    if (direction === 'next') {
      currentTranslate = Math.min(currentTranslate + totalMove, maxScroll);
    } else {
      currentTranslate = Math.max(currentTranslate - totalMove, 0);
    }
    
    slider.style.transform = `translateX(-${currentTranslate}px)`;
    updateProgress();
  };

  next?.addEventListener('click', () => moveSlider('next'));
  prev?.addEventListener('click', () => moveSlider('prev'));

  // Initialize progress
  window.addEventListener('load', updateProgress);

  // Handle resize
  window.addEventListener('resize', () => {
    currentTranslate = 0;
    if (slider) slider.style.transform = `translateX(0px)`;
    updateProgress();
  });
</script>
